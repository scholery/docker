upstream container-web {
    server container_web1:8081;       #server1
    server container_web2:8081;       #server1
}
upstream container-api {
    server container_web1:8080;       #server1
    server container_web2:8080;       #server1
}

server {
	listen       80;
	client_max_body_size     64m;
	server_name  www.wuzhendai.com wuzhendai.com;
	access_log   /var/log/nginx/wuzhendai.access.log  main;
	location / {
		rewrite ^(.*)$ https://www.wuzhendai.com$1 permanent;
		#proxy_pass http://localhost:8022;
		#proxy_connect_timeout 600;
		#proxy_read_timeout 600;
		#proxy_http_version 1.1;
		#proxy_set_header Host $host:$server_port;
		#proxy_set_header Upgrade $http_upgrade;
		#proxy_set_header Connection "";
	}
	location /p2pweb/appserver/WebService.asmx {
		proxy_pass http://localhost:8022;
		proxy_connect_timeout 600;
		proxy_read_timeout 600;
		proxy_http_version 1.1;
		proxy_set_header Host $host:$server_port;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "";
	}
	location /p2pweb/appserver/download.html {
        rewrite /p2pweb/appserver/download.html http://www.wuzhendai.com/appdownload/andriod/com.bananc.android-release.apk break;
	}
}

server {
	listen 443 ssl;
	client_max_body_size     64m;
	server_name www.wuzhendai.com;
	ssl_certificate /usr/share/nginx/ssl/www.wuzhendai.com.cer;
	ssl_certificate_key /usr/share/nginx/ssl/www.wuzhendai.com.key;
    location / {
		proxy_pass http://localhost:8022;
		proxy_connect_timeout 600;
		proxy_read_timeout 600;
		proxy_http_version 1.1;
		proxy_set_header Host $host:$server_port;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade";
	}
}
server {
	listen       8022;
    server_name www.wuzhendai.com;
	client_max_body_size     64m;
    location / {
		root   /usr/share/nginx/html/wuzhendai-website;
		index  index.html index.htm;
	}
	
	location /wechat {
		root   //usr/share/nginx/html/;
		index  login.html;
	}

	location /api {
		proxy_pass http://localhost:8021/lfcp-api/api;
		proxy_connect_timeout 600;
		proxy_read_timeout 600;
		proxy_http_version 1.1;
        proxy_set_header Host $host:$server_port;	
	    proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection ""; 
	}
    location /txwzd {
		proxy_pass http://localhost:8021/lfcp-api/txwzd;
		proxy_connect_timeout 600;
		proxy_read_timeout 600;
		proxy_http_version 1.1;
        proxy_set_header Host $host:$server_port;	
	    proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade"; 
	}

	location /p2pweb/appserver/WebService.asmx {
        proxy_pass http://localhost:8021/lfcp-web/webservice/appWebService?wsdl;
		proxy_connect_timeout 600;
		proxy_read_timeout 600;
		proxy_http_version 1.1;
        proxy_set_header Host $host:$server_port;	
	    proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade"; 
	}
    location /upload {
	   proxy_pass http://localhost:8021/upload/;
	}
		
	location /appdownload/andriod {
        proxy_pass http://sftp:8001/wuzhendai/;
	}
	location /p2pweb/contract {
	   proxy_pass http://localhost:8021/upload/contract/;
	}
	#use to app 
	location /p2pweb/contract/pdf/p2pweb/ {
	   proxy_pass http://localhost:8021/upload/;
	}
    location /p2pweb/contract/pdf/upload {
        proxy_pass http://localhost:8021/upload/;
	}
     #use to app 
	location /p2pweb/contract/standard/upload {
	   proxy_pass http://localhost:8021/upload/;
	}
       location /p2pweb/images {
	   proxy_pass http://localhost:8021/upload/images/;
	}
	location /p2pweb/images2 {
	   proxy_pass http://localhost:8021/upload/images2/;
	}
	location /p2pweb/upload {
	   proxy_pass http://localhost:8021/upload/uploadold/;
	}
	location /p2pweb/UploadFile {
	   proxy_pass http://localhost:8021/upload/UploadFile/;
	}
	location /p2pweb/image {
	   proxy_pass http://localhost:8021/upload/image/;
	}
	location /p2pweb/kindeditor/plugins/image {
	   proxy_pass http://localhost:8021/upload/image/;
	}
	location /p2pweb/kindeditor/attached/image {
	   proxy_pass http://localhost:8021/upload/image/;
	}
	add_header Cache-Control no-store;
	add_header Pragma: no-cache;
}

server {
	listen       8021;
	server_name www.wuzhendai.com;
	client_max_body_size     64m;
	location / {
		root   /usr/share/nginx/html/lfcp-pages;
		index  index.html index.htm;
	}

	location /upload {
		proxy_pass   http://sftp:8001/upload;
		proxy_connect_timeout 600;
		proxy_read_timeout 600;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade";
	}

	location /api {
		proxy_pass http://container-api/lfcp-api/api;
		proxy_connect_timeout 600;
		proxy_read_timeout 600;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "";
	}
	location /lfcp-api {
		proxy_pass http://container-api;
		proxy_connect_timeout 600;
		proxy_read_timeout 600;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "";
	}
	location /lfcp-web {
		proxy_pass http://container-web;
		proxy_connect_timeout 600;
		proxy_read_timeout 600;
		proxy_http_version 1.1;
        proxy_set_header Host $host:$server_port;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "";
	}
    location /service {
		proxy_pass   http://container-web/lfcp-web/service;
		proxy_connect_timeout 600;
		proxy_read_timeout 600;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "";
	}
	location /websocket {
		proxy_pass   http://container-web/lfcp-web/service/websocket;
		proxy_connect_timeout 600;
		proxy_read_timeout 600;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "";
	}
}
